@page "/register"
@layout FirstLayout
@using ShareSphere.Data
@inject NavigationManager navMan
@inject FirebaseAuthentication firebaseAuth
@inject FirebaseDatabaseGamer db

<form id="register-form">
    <h3>Register</h3>
    <div class="form-group">
        <label for="username-input">Username</label>
        <div id="username-input-div">
            <input type="text" id="username-input" @bind="@username" class="form-control" placeholder="Username">
        </div>
    </div>
    <div class="form-group">
        <label for="email-input">E-Mail</label>
        <div id="email-input-div">
            <input type="email" id="email-input" @bind="@email" class="form-control" placeholder="E-Mail">
        </div>
    </div>
    <div class="form-group">
        <label for="password-input">Password</label>
        <div id="password-input-div">
            <input type="password" id="password-input" @bind="@passwort" class="form-control" placeholder="Password">
        </div>
    </div>
    <div class="form-group">
        <label for="repeat-password-input">Repeat password</label>
        <div id="repeat-password-input-div">
            <input type="password" id="repeat-password-input" @bind="@repPasswort" class="form-control" placeholder="Repeat password">
        </div>
    </div>
    <div class="form-group">
        <div id="register-btn-div">
            <button id="register-btn" onclick="@register" class="gradient-btn w-100">Register</button>
        </div>
    </div>
    <div id="switch-link-div" class="form-group">
        <a href="/">Go to login</a>
    </div>
</form>

@code {
    private string username;
    private string email;
    private string passwort;
    private string repPasswort;

    async void register()
    {
        if ((passwort == repPasswort) && (ShareSphere.Data.Policies.checkEmail(email)) && (ShareSphere.Data.Policies.checkUsername(username)) && (ShareSphere.Data.Policies.checkPassword(passwort)))
        {
            try
            {
                UserCredential userCredentials = await firebaseAuth.getClient().CreateUserWithEmailAndPasswordAsync(email, passwort, username);
                if (userCredentials != null)
                {
                    Gamer gamer = new Gamer(userCredentials.User.Uid, username);
                    db.addGamer(gamer);
                    navMan.NavigateTo("/forMe");
                }
            } catch (FirebaseAuthException ex)
            {
                
            }

        }

    }

}
